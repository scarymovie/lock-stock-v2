# **Lock-Stock v2**

## **О проекте**

Lock-Stock v2 — это backend-приложение для игры, основанной на популярном YouTube-шоу "Lock stock". Основная цель
проекта — предоставить игровую механику, управляемую через API.


---

## **Технологии**

- **Язык:** Go
- **База данных:** PostgreSQL
- **Контейнеризация:** Docker + Docker Compose
- **Миграции:** golang-migrate
- **Сетевой фреймворк:** Chi
- **Dependency Injection:** Wire

---

### API маршруты

Проект включает следующие основные маршруты:

- [WebSocket маршруты](app/handlers/http/ws/ws.yaml)
- [Маршруты пользователя](app/handlers/http/user/user.yaml)
- [Маршруты комнат](app/handlers/http/room/room.yaml)

---

## **Запуск проекта**

### **1. Установка**

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/username/lock-stock-v2.git
   ```
2. Запустите команду:
   ```bash
   make init
   ```
   
---

## **Планы на будущее**
1. **Добавить тесты:**
   - Покрыть unit-тестами основные use-case сервисы.
   - Добавить интеграционные тесты.

2. **Расширить функционал:**
   - Добавить новые API-эндпоинты.
   - Перенести отправку сообщений в web socket на kafka? 

3. **Документация:**
   - ✔ ~~Добавить подробное описание всех маршрутов.~~
   - ✔ ~~Генерация кода на основе yaml файлов~~

4. **Non-dev environment**
   - Настройка docker окружения для qa и prod окружений
   - Настройка подключения к бд для qa и prod окружений
   - Настройка подключения зависимостей для каждого окружения
   - 
5. **Dev enviroment:**
   - Сделать сборку "на лету, чтобы не пересобирать каждый раз контейнеры
---

## **Контакты**
Если у вас есть вопросы или предложения, свяжитесь с разработчиком:

- GitHub: [scarymovie](https://github.com/scarymovie)
- Email: vino.zeka@gmail.com


## **Основные сущности**

Проект оперирует следующими основными сущностями:

-   **User:** Пользователь системы. Обладает уникальным идентификатором (UID) и именем.
-   **Room:** Игровая комната, где собираются игроки для участия в игре. Комната имеет уникальный идентификатор (UID) и статус (`pending`, `in_progress`, `finished`).
-   **RoomUser:** Связующая сущность между комнатой и пользователем. Позволяет отслеживать, какие пользователи находятся в какой комнате.
-   **LockStockGame:** Сама игра. Имеет уникальный идентификатор (UID), длительность действия (`action_duration`), длительность вопроса (`question_duration`), и связана с комнатой.
-   **Round:** Раунд внутри игры. Имеет номер (`number`), байин (`buy_in`) и пот (`pot`). Связан с игрой.
-   **Bet:** Ставка игрока на раунд. Содержит сумму ставки (`amount`), связана с игроком и раундом, а также имеет номер (`number`).
-   **Hint:** Подсказка, которая может быть предоставлена в раунде.
- **Question:** Вопрос для раунда. Имеет текст и набор подсказок.

## **Функциональные возможности**

Проект предоставляет следующий функционал:

### **Управление пользователями:**

-   **Создание пользователя:** Позволяет зарегистрировать нового пользователя в системе.
-   **Авторизация пользователя:** Позволяет войти в систему.

### **Управление комнатами:**

-   **Создание комнаты:** Создание новой игровой комнаты, в которой пользователи смогут собираться для игры.
-   **Список комнат:** Получение списка всех комнат со статусом "pending".
-   **Изменение статуса комнаты:** Позволяет изменить статус комнаты (например, с "pending" на "in_progress").
-   **Получение информации о комнате** Получение информации о комнате по `id`
- **Подключение к комнате:** Позволяет пользователю подключиться к комнате.
- **Список пользователей в комнате:** Позволяет получить список пользователей, которые подключены к комнате.

### **Управление игрой:**

-   **Создание игры:** Создание новой игры, связанной с конкретной комнатой.
-   **Создание раунда:** Создание нового раунда в игре.
- **Найти последний раунд:** Найти последний раунд в игре.
- **Найти все раунды:** Найти все раунды в игре.
-   **Сохранение ставки:** Позволяет игроку сделать ставку на раунд.

### **WebSocket взаимодействие:**

-   **Подключение:** Пользователи могут подключиться к WebSocket серверу для получения обновлений в реальном времени.
- **Отправка события:** После совершения ставки, генерируется событие `bet_created`
-   **Получение событий:** Клиенты могут получать события, такие как начало игры (`game_started`), создание ставки (`bet_created`) и другие.

## **API Маршруты**

Проект включает следующие основные маршруты (описание на основе YAML файлов):

### **WebSocket Routes** ([app/handlers/http/ws/ws.yaml](app/handlers/http/ws/ws.yaml))

-   `/ws`: Маршрут для установления WebSocket-соединения.

### **User Routes** ([app/handlers/http/user/user.yaml](app/handlers/http/user/user.yaml))

-   `POST /api/user`: Создание нового пользователя.
   -   Request Body: `{"name": "User Name"}`
   -   Response Body: `{"uid": "user-uuid", "name": "User Name"}`
-   `GET /api/user`: Получение всех пользователей.
- `GET /api/user/user_id` Получить пользователя по id

### **Room Routes** ([app/handlers/http/room/room.yaml](app/handlers/http/room/room.yaml))

-   `POST /api/room`: Создание новой комнаты.
   -   Response Body: `{"uid": "room-uuid", "status": "pending"}`
-   `GET /api/room`: Получение списка всех комнат со статусом "pending".
   -   Response Body: `[{"uid": "room-uuid", "status": "pending"}, ...]`
-   `POST /api/room/join`: Подключиться к комнате.
   - Request Body: `{"userUid": "user-uuid", "roomUid": "room-uuid"}`
-   `GET /api/room/{id}`: Получить информацию о комнате по id.
   - Response Body: `{"uid": "room-uuid", "status": "pending"}`
-   `POST /api/room/start`: Начать игру.
   - Request Body: `{"roomUid": "room-uuid"}`
- `GET /api/room/users`: Получить список пользователей в комнате.
   - Request Body: `{"roomUid": "room-uuid"}`

